!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.AdzStripeDonations=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var donationForm=require("./lib/donationForm");module.exports={donationForm:donationForm}},{"./lib/donationForm":2}],2:[function(require,module,exports){function onStripeJsLoaded(){Stripe.setPublishableKey(adz_stripe_donations_vars.stripe_public_api_key)}function setupInterface(){$("#donation_custom_once").payment("restrictNumeric"),$("#donation_custom_monthly").payment("restrictNumeric")}function setupValidation(){$("#donation_custom_once").payment("restrictNumeric"),$("#donation_custom_monthly").payment("restrictNumeric"),$(".cc-number").payment("formatCardNumber"),$(".cc-cvc").payment("formatCardCVC"),$(".exp-month").payment("restrictNumeric"),$(".exp-year").payment("restrictNumeric"),$.fn.toggleInputError=function(erred){return this.closest(".form-row").toggleClass("has-error",erred),this}}function doValidation(){var cardType=$.payment.cardType($(".cc-number").val());return $(".cc-number").toggleInputError(!$.payment.validateCardNumber($(".cc-number").val())),$(".cc-cvc").toggleInputError(!$.payment.validateCardCVC($(".cc-cvc").val(),cardType)),$(".cc-exp").toggleInputError(!Stripe.card.validateExpiry($(".exp-month").val(),$(".exp-year").val())),$(".validation").removeClass("text-danger text-success"),$(".validation").addClass($(".has-error").length?"text-danger":"text-success"),$("#giftaidcheckbox:checked").length&&$(".giftaid-fields .required").each(function(i,itm){$(itm).toggleInputError(!$(itm).val().length)}),$(".has-error").length}function onFormDataSaved(res){form_submitted_callback&&form_submitted_callback(res)}function stripeResponseHandler(status,response){var $form=$(stripe_donation_form);if(response.error)$form.find(".payment-errors").text(response.error.message),$form.find("button").prop("disabled",!1);else{var token=response.id;$form.append($('<input type="hidden" name="stripeToken" />').val(token)),$form.append($('<input type="hidden" name="action" value="submit_donation" />')),$.post(adz_stripe_donations_vars.ajaxurl,$form.serialize(),onFormDataSaved)}}function onFormSubmit(event){var $form=$(stripe_donation_form);return event.preventDefault(),doValidation()?!1:($form.find("button").prop("disabled",!0),Stripe.card.createToken($form,stripeResponseHandler),!1)}function init(form_id,launchedCallback,submittedCallback){form_id&&(stripe_donation_form=form_id),submittedCallback&&(form_submitted_callback=submittedCallback),setupInterface(),setupValidation(),$(stripe_donation_form).submit(onFormSubmit),$.getScript(adz_stripe_donations_vars.stripe_js_url,function(){onStripeJsLoaded(),launchedCallback&&launchedCallback()})}var $=jQuery;require("jquery.payment");var stripe_donation_form="#stripe-donation-form",form_submitted_callback=null;module.exports=init},{"jquery.payment":3}],3:[function(require,module,exports){(function(){var cardFromNumber,cardFromType,cards,defaultFormat,formatBackCardNumber,formatBackExpiry,formatCardNumber,formatExpiry,formatForwardExpiry,formatForwardSlashAndSpace,hasTextSelected,luhnCheck,reFormatCVC,reFormatCardNumber,reFormatExpiry,reFormatNumeric,restrictCVC,restrictCardNumber,restrictExpiry,restrictNumeric,setCardType,__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};$.payment={},$.payment.fn={},$.fn.payment=function(){var args,method;return method=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],$.payment.fn[method].apply(this,args)},defaultFormat=/(\d{1,4})/g,$.payment.cards=cards=[{type:"visaelectron",pattern:/^4(026|17500|405|508|844|91[37])/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"maestro",pattern:/^(5(018|0[23]|[68])|6(39|7))/,format:defaultFormat,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",pattern:/^600/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",pattern:/^5019/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"visa",pattern:/^4/,format:defaultFormat,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^(5[0-5]|2[2-7])/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",pattern:/^3[0689]/,format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",pattern:/^6([045]|22)/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^(62|88)/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",pattern:/^35/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0}],cardFromNumber=function(num){var card,_i,_len;for(num=(num+"").replace(/\D/g,""),_i=0,_len=cards.length;_len>_i;_i++)if(card=cards[_i],card.pattern.test(num))return card},cardFromType=function(type){var card,_i,_len;for(_i=0,_len=cards.length;_len>_i;_i++)if(card=cards[_i],card.type===type)return card},luhnCheck=function(num){var digit,digits,odd,sum,_i,_len;for(odd=!0,sum=0,digits=(num+"").split("").reverse(),_i=0,_len=digits.length;_len>_i;_i++)digit=digits[_i],digit=parseInt(digit,10),(odd=!odd)&&(digit*=2),digit>9&&(digit-=9),sum+=digit;return sum%10===0},hasTextSelected=function($target){var _ref;return null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==$target.prop("selectionEnd")?!0:null!=("undefined"!=typeof document&&null!==document&&null!=(_ref=document.selection)?_ref.createRange:void 0)&&document.selection.createRange().text?!0:!1},reFormatNumeric=function(e){return setTimeout(function(){var $target,value;return $target=$(e.currentTarget),value=$target.val(),value=value.replace(/\D/g,""),$target.val(value)})},reFormatCardNumber=function(e){return setTimeout(function(){var $target,value;return $target=$(e.currentTarget),value=$target.val(),value=$.payment.formatCardNumber(value),$target.val(value)})},formatCardNumber=function(e){var $target,card,digit,length,re,upperLength,value;return digit=String.fromCharCode(e.which),!/^\d+$/.test(digit)||($target=$(e.currentTarget),value=$target.val(),card=cardFromNumber(value+digit),length=(value.replace(/\D/g,"")+digit).length,upperLength=16,card&&(upperLength=card.length[card.length.length-1]),length>=upperLength||null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==value.length)?void 0:(re=card&&"amex"===card.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,re.test(value)?(e.preventDefault(),setTimeout(function(){return $target.val(value+" "+digit)})):re.test(value+digit)?(e.preventDefault(),setTimeout(function(){return $target.val(value+digit+" ")})):void 0)},formatBackCardNumber=function(e){var $target,value;return $target=$(e.currentTarget),value=$target.val(),8!==e.which||null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==value.length?void 0:/\d\s$/.test(value)?(e.preventDefault(),setTimeout(function(){return $target.val(value.replace(/\d\s$/,""))})):/\s\d?$/.test(value)?(e.preventDefault(),setTimeout(function(){return $target.val(value.replace(/\d$/,""))})):void 0},reFormatExpiry=function(e){return setTimeout(function(){var $target,value;return $target=$(e.currentTarget),value=$target.val(),value=$.payment.formatExpiry(value),$target.val(value)})},formatExpiry=function(e){var $target,digit,val;return digit=String.fromCharCode(e.which),/^\d+$/.test(digit)?($target=$(e.currentTarget),val=$target.val()+digit,/^\d$/.test(val)&&"0"!==val&&"1"!==val?(e.preventDefault(),setTimeout(function(){return $target.val("0"+val+" / ")})):/^\d\d$/.test(val)?(e.preventDefault(),setTimeout(function(){return $target.val(""+val+" / ")})):void 0):void 0},formatForwardExpiry=function(e){var $target,digit,val;return digit=String.fromCharCode(e.which),/^\d+$/.test(digit)?($target=$(e.currentTarget),val=$target.val(),/^\d\d$/.test(val)?$target.val(""+val+" / "):void 0):void 0},formatForwardSlashAndSpace=function(e){var $target,val,which;return which=String.fromCharCode(e.which),"/"===which||" "===which?($target=$(e.currentTarget),val=$target.val(),/^\d$/.test(val)&&"0"!==val?$target.val("0"+val+" / "):void 0):void 0},formatBackExpiry=function(e){var $target,value;return $target=$(e.currentTarget),value=$target.val(),8!==e.which||null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==value.length?void 0:/\d\s\/\s$/.test(value)?(e.preventDefault(),setTimeout(function(){return $target.val(value.replace(/\d\s\/\s$/,""))})):void 0},reFormatCVC=function(e){return setTimeout(function(){var $target,value;return $target=$(e.currentTarget),value=$target.val(),value=value.replace(/\D/g,"").slice(0,4),$target.val(value)})},restrictNumeric=function(e){var input;return e.metaKey||e.ctrlKey?!0:32===e.which?!1:0===e.which?!0:e.which<33?!0:(input=String.fromCharCode(e.which),!!/[\d\s]/.test(input))},restrictCardNumber=function(e){var $target,card,digit,value;return $target=$(e.currentTarget),digit=String.fromCharCode(e.which),/^\d+$/.test(digit)&&!hasTextSelected($target)?(value=($target.val()+digit).replace(/\D/g,""),card=cardFromNumber(value),card?value.length<=card.length[card.length.length-1]:value.length<=16):void 0},restrictExpiry=function(e){var $target,digit,value;return $target=$(e.currentTarget),digit=String.fromCharCode(e.which),/^\d+$/.test(digit)&&!hasTextSelected($target)?(value=$target.val()+digit,value=value.replace(/\D/g,""),value.length>6?!1:void 0):void 0},restrictCVC=function(e){var $target,digit,val;return $target=$(e.currentTarget),digit=String.fromCharCode(e.which),/^\d+$/.test(digit)&&!hasTextSelected($target)?(val=$target.val()+digit,val.length<=4):void 0},setCardType=function(e){var $target,allTypes,card,cardType,val;return $target=$(e.currentTarget),val=$target.val(),cardType=$.payment.cardType(val)||"unknown",$target.hasClass(cardType)?void 0:(allTypes=function(){var _i,_len,_results;for(_results=[],_i=0,_len=cards.length;_len>_i;_i++)card=cards[_i],_results.push(card.type);return _results}(),$target.removeClass("unknown"),$target.removeClass(allTypes.join(" ")),$target.addClass(cardType),$target.toggleClass("identified","unknown"!==cardType),$target.trigger("payment.cardType",cardType))},$.payment.fn.formatCardCVC=function(){return this.on("keypress",restrictNumeric),this.on("keypress",restrictCVC),this.on("paste",reFormatCVC),this.on("change",reFormatCVC),this.on("input",reFormatCVC),this},$.payment.fn.formatCardExpiry=function(){return this.on("keypress",restrictNumeric),this.on("keypress",restrictExpiry),this.on("keypress",formatExpiry),this.on("keypress",formatForwardSlashAndSpace),this.on("keypress",formatForwardExpiry),this.on("keydown",formatBackExpiry),this.on("change",reFormatExpiry),this.on("input",reFormatExpiry),this},$.payment.fn.formatCardNumber=function(){return this.on("keypress",restrictNumeric),this.on("keypress",restrictCardNumber),this.on("keypress",formatCardNumber),this.on("keydown",formatBackCardNumber),this.on("keyup",setCardType),this.on("paste",reFormatCardNumber),this.on("change",reFormatCardNumber),this.on("input",reFormatCardNumber),this.on("input",setCardType),this},$.payment.fn.restrictNumeric=function(){return this.on("keypress",restrictNumeric),this.on("paste",reFormatNumeric),this.on("change",reFormatNumeric),this.on("input",reFormatNumeric),this},$.payment.fn.cardExpiryVal=function(){return $.payment.cardExpiryVal($(this).val())},$.payment.cardExpiryVal=function(value){var month,prefix,year,_ref;return value=value.replace(/\s/g,""),_ref=value.split("/",2),month=_ref[0],year=_ref[1],2===(null!=year?year.length:void 0)&&/^\d+$/.test(year)&&(prefix=(new Date).getFullYear(),prefix=prefix.toString().slice(0,2),year=prefix+year),month=parseInt(month,10),year=parseInt(year,10),{month:month,year:year}},$.payment.validateCardNumber=function(num){var card,_ref;return num=(num+"").replace(/\s+|-/g,""),/^\d+$/.test(num)?(card=cardFromNumber(num),card?(_ref=num.length,__indexOf.call(card.length,_ref)>=0&&(card.luhn===!1||luhnCheck(num))):!1):!1},$.payment.validateCardExpiry=function(month,year){var currentTime,expiry,_ref;return"object"==typeof month&&"month"in month&&(_ref=month,month=_ref.month,year=_ref.year),month&&year?(month=$.trim(month),year=$.trim(year),/^\d+$/.test(month)&&/^\d+$/.test(year)&&month>=1&&12>=month?(2===year.length&&(year=70>year?"20"+year:"19"+year),4!==year.length?!1:(expiry=new Date(year,month),currentTime=new Date,expiry.setMonth(expiry.getMonth()-1),expiry.setMonth(expiry.getMonth()+1,1),expiry>currentTime)):!1):!1},$.payment.validateCardCVC=function(cvc,type){var card,_ref;return cvc=$.trim(cvc),/^\d+$/.test(cvc)?(card=cardFromType(type),null!=card?(_ref=cvc.length,__indexOf.call(card.cvcLength,_ref)>=0):cvc.length>=3&&cvc.length<=4):!1},$.payment.cardType=function(num){var _ref;return num?(null!=(_ref=cardFromNumber(num))?_ref.type:void 0)||null:null},$.payment.formatCardNumber=function(num){var card,groups,upperLength,_ref;return num=num.replace(/\D/g,""),(card=cardFromNumber(num))?(upperLength=card.length[card.length.length-1],num=num.slice(0,upperLength),card.format.global?null!=(_ref=num.match(card.format))?_ref.join(" "):void 0:(groups=card.format.exec(num),null!=groups?(groups.shift(),groups=$.grep(groups,function(n){return n}),groups.join(" ")):void 0)):num},$.payment.formatExpiry=function(expiry){var mon,parts,sep,year;return(parts=expiry.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(mon=parts[1]||"",sep=parts[2]||"",year=parts[3]||"",year.length>0?sep=" / ":" /"===sep?(mon=mon.substring(0,1),sep=""):2===mon.length||sep.length>0?sep=" / ":1===mon.length&&"0"!==mon&&"1"!==mon&&(mon="0"+mon,sep=" / "),mon+sep+year):""}}).call(this)},{}]},{},[1])(1)});
//# sourceMappingURL=./adz-stripe-donations.u.js.map